@if (isLoading() || categories().length === 0) {
  <div class="flex justify-center items-center py-20">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[var(--accent)]"></div>
  </div>
} @else if (error()) {
  <div class="text-center py-8 text-red-500">
    {{ error() }}
  </div>
} @else {
  <div class="py-8">
    @for (category of categories(); track category.category_id; let i = $index) {
      <!-- Category Section -->
      <div class="mb-8">
        <div class="container px-3 mx-auto mb-4">
          <div class="flex justify-between items-center">
            <h2 class="text-2xl md:text-3xl font-bold text-[var(--text-primary)]">
              {{ category.category_name_en }}
            </h2>
            <a 
              [routerLink]="['/category', category.category_id]" 
              class="text-[var(--accent)] hover:text-[var(--primary)] text-sm font-medium">
              View All
            </a>
          </div>
        </div>

        <!-- Products Carousel -->
        @if (category.products && category.products.length > 0) {
          <div class="container px-3 mx-auto relative">
            <div class="carousel-wrapper">
              <div 
                id="carousel-{{ category.category_id }}"
                class="flex gap-4 pb-4 carousel-content"
                (wheel)="preventWheelScroll($event, 'carousel-' + category.category_id)"
                style="touch-action: pan-x;">
                @for (product of category.products; track product.sku_id) {
                  <div class="flex-shrink-0 w-[180px] md:w-[260px]">
                    <app-product-card 
                      [productdata]="convertProduct(product)" 
                      class="w-full" />
                  </div>
                }
              </div>
            </div>

            <!-- Carousel Navigation Arrows -->
            @if (category.products.length > 4) {
              <button
                (click)="scrollLeft(category.category_id, 'carousel-' + category.category_id)"
                class="hidden md:block absolute left-4 top-1/2 -translate-y-1/2 bg-black/80 hover:bg-black text-white p-2 rounded-full z-10 transition-all">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button
                (click)="scrollRight(category.category_id, 'carousel-' + category.category_id)"
                class="hidden md:block absolute right-4 top-1/2 -translate-y-1/2 bg-black/80 hover:bg-black text-white p-2 rounded-full z-10 transition-all">
                <i class="fas fa-chevron-right"></i>
              </button>
            }
          </div>
        } @else {
          <div class="text-center py-8 text-gray-500">
            No products available
          </div>
        }
      </div>

      <!-- Show one banner after each category -->
      @if (i < categories().length - 1) {
        @let banner = getBannerForIndex(i);
        @if (banner) {
          <div class="py-5 mb-8 w-full">
            <div class="w-full">
              <a 
                [href]="banner.link || '#'" 
                [target]="banner.link?.startsWith('http') ? '_blank' : '_self'"
                class="banner-link block w-full overflow-hidden rounded-xl px-4 md:px-8 lg:px-12 group">
                <div class="banner-image-wrapper relative overflow-hidden rounded-xl">
                  <img 
                    [src]="getBannerImageUrl(banner.imageUrl)" 
                    [alt]="banner.title"
                    class="banner-image w-full h-auto object-contain transition-transform duration-500"
                    loading="lazy"
                    (error)="$event.target.src='assets/images/placeholder.jpg'" />
                  <div class="banner-overlay absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all duration-500"></div>
                </div>
              </a>
            </div>
          </div>
        }
      }
    }
  </div>
}

